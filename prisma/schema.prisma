// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
	provider = "prisma-client-js"
}

datasource db {
	provider = "postgresql"
}

enum Role {
	SYSTEM
	USER
	ASSISTANT
}

model Conversation {
	id        String       @id @default(uuid())
	title     String       @default("New Conversation")
	createdAt DateTime     @default(now())
	updatedAt DateTime     @updatedAt

	nodes     MessageNode[]

	@@index([createdAt])
	@@index([updatedAt])
}

model MessageNode {
	id             String       @id @default(uuid())
	conversationId String
	parentId       String?
	role           Role
	content        String       @db.Text
	createdAt      DateTime     @default(now())

	// Adjacency list pattern for tree structure
	parent   MessageNode?  @relation("TreeStructure", fields: [parentId], references: [id], onDelete: Cascade)
	children MessageNode[] @relation("TreeStructure")

	// Relation to Conversation
	conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

	@@index([conversationId])
	@@index([parentId])
	@@index([createdAt])
}
