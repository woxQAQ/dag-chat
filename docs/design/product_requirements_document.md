# 结构化思维流聊天机器人 (MindFlow) - 产品定义文档 (PRD)

## 1. 产品背景与问题陈述 (Context & Problem)

### 1.1 现状
目前基于 LLM 的聊天产品（如 ChatGPT, Claude）普遍采用即时通讯（IM）式的**线性交互界面**。虽然它们支持“编辑历史消息”来产生分支，但这些分支被隐藏在单一节点的 `< 1/2 >` 切换按钮之下。

### 1.2 用户痛点
*   **结构感知缺失**：用户的大脑在处理复杂问题时往往是发散的（树状或网状），但线性 UI 强迫用户将思维压缩为一条线，导致认知模型与交互模型不匹配。
*   **上下文迷失（Context Loss）**：在长对话中，用户难以快速回顾之前的分叉点。当需要寻找“另一条可能更好的路径”时，用户必须进行大量的滚动和点击操作，认知负荷极高。
*   **创造性受阻**：在进行头脑风暴或代码重构时，用户不敢轻易尝试新的方向，因为担心“弄乱”当前好不容易得到的上下文，或者一旦分支就再也找不回原来的路径。

## 2. 产品愿景 (Vision)
打造一款**“思维可视化”**的 AI 交互工具。将对话的底层**拓扑结构（Topology）**显性化，赋予用户上帝视角，使其能够像管理思维导图一样管理对话，从而支持更深度的探索、更复杂的逻辑推理和更具创造性的任务。

## 3. 产品定位 (Positioning)
*   **目标用户**：开发者、架构师、创作者、研究人员等专业用户。
*   **产品形态**：垂直于“生产力工具”或“Prompt Engineering IDE”，而非大众化的闲聊工具。

## 4. 核心功能与交互设计 (Core Features & UX)

### 4.1 界面布局：侧边栏图结构 (Sidebar Graph)
*   **设计原则**：保持主对话区的沉浸感，不使用复杂的自由画布（Flowchart）形式，避免过度设计。
*   **导航层级**：采用**二级导航模式**。
    *   **Level 1**: 全局会话列表 (All Chats)。
    *   **Level 2**: 单个会话的思维树 (Tree View)。
*   **实现形式**：类似 Git Graph 或 IDE 的文件大纲树。
    *   **节点表示**：每个提问和回答作为一个节点。
    *   **层级关系**：清晰展示父子关系和分支点。

### 4.2 核心交互：基于回溯的编辑分叉 (Backtracking & Forking)
这是产品最核心的交互模式，旨在鼓励用户进行非线性的探索。
*   **非破坏性编辑 (Non-destructive Editing)**：
    *   用户随时可以点击侧边栏中的任意历史提问节点（或主界面的历史消息）。
    *   进入“编辑模式”修改提问后，系统**永远不会覆盖**原有记录，而是立即在该节点处生成一个新的分支（Fork）。
    *   **侧边栏响应**：侧边栏自动展开，清晰地画出一条新的连线，表明这是一个平行的思考路径。
*   **分支切换与对比**：
    *   用户可以随时点击旧的分支节点，主界面瞬间回滚到那个状态，就像时光机一样。
    *   这赋予用户“反悔”的权利，也赋予用户“同时探索多种可能性”的能力。

### 4.3 上下文感知高亮 (Context-Aware Highlighting)
为了解决“用户误以为相邻节点在同一上下文”的问题，UI 必须明确区分“当前路径”与“其他分支”。
*   **交互逻辑**：
    *   **默认状态**：高亮显示当前正在进行的对话路径。
    *   **悬停/点击**：当用户鼠标悬停或点击侧边栏的任意节点时，系统自动**高亮**从根节点（Start）到该节点（End）的完整路径。
    *   **置灰处理**：所有不在当前激活路径上的节点（即 LLM 看不到的上下文）自动**变灰/模糊化**。
*   **价值**：直观地告诉用户 AI 的注意力（Attention）在哪里，什么是“生效”的上下文。

### 4.3 分支管理 (Branch Management)
*   **创建分支**：在主对话流中修改任意提问，自动在侧边栏生成一个新的分支节点，而不是覆盖原节点。
*   **分支切换**：点击侧边栏的节点，主对话区瞬间切换到该节点所在的历史状态。
*   **平行比较**：支持在 UI 上横向对比同一提问的两个不同分支的回答（A/B Test 思路）。
*   **剪枝 (Pruning)**：允许用户折叠或标记“废弃”的分支，保持侧边栏整洁。

## 5. 目标用户场景 (User Scenarios)

| 用户群体 | 典型场景 | 价值主张 |
| :--- | :--- | :--- |
| **开发者/架构师** | 代码调试、架构设计 | 在保留原有报错堆栈的同时，尝试多种不同的修复方案（Branch A: 修改配置, Branch B: 修改代码），而不丢失上下文。 |
| **创作者/作家** | 故事线构思、剧本创作 | 同时发展故事的三个不同结局，对比哪个更具张力，且能随时回溯到剧情转折点。 |
| **研究人员/分析师** | 深度调研、论文润色 | 针对一个论点进行多角度的苏格拉底式提问，构建完整的论证树。 |

## 6. 下一步计划 (Next Steps)
*   设计侧边栏 Tree View 的原型草图。
*   定义数据结构（Node, Edge, Tree）。
*   验证“上下文高亮”交互的可行性。
