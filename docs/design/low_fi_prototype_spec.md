# 低保真原型描述 (Low-fi Prototype Spec) - MindFlow

本文档描述了 MindFlow 的界面布局与核心交互逻辑。设计目标是平衡“沉浸式对话”与“结构化导航”。

## 1. 界面布局 (Layout Overview)

界面分为两个主要区域：左侧的 **[思维树侧边栏]** 和右侧的 **[对话流主视窗]**。

为了兼顾“多会话管理”，侧边栏引入了**二级导航模式**。

```text
+----------------------+--------------------------------------------------+
|  Sidebar (Tree)      |            Main Chat Area (Stream)               |
| [ < All Chats ]      |            [Current Active Path Only]            |
|                      |                                                  |
|  [Root]              |  +--------------------------------------------+  |
|    |                 |  | System: You are a helpful assistant...     |  |
|  [Q1]                |  +--------------------------------------------+  |
|    |                 |                                                  |
|  [A1]                |  +--------------------------------------------+  |
|    | (Fork Point)    |  | User (Q1): Hello                           |  |
|  [Q2a]--+            |  +--------------------------------------------+  |
|    |    |            |                                                  |
|  [A2a]  |            |  +--------------------------------------------+  |
|         |            |  | AI (A1): Hi there!                         |  |
|       [Q2b]*         |  +--------------------------------------------+  |
|         |            |                                                  |
|       [A2b]*         |  +--------------------------------------------+  |
|                      |  | User (Q2b): (Edited) How to fix this bug?  |  |
|                      |  +--------------------------------------------+  |
|                      |                                                  |
|                      |  +--------------------------------------------+  |
|                      |  | AI (A2b): You can try this code...         |  |
|                      |  +--------------------------------------------+  |
|                      |                                                  |
|                      |           [Input Box: Type a message...]         |
+----------------------+--------------------------------------------------+
(* 表示当前激活的节点。注意：Sidebar 里的 Q2a 分支在 Main Area 是不可见的)
```

## 2. 侧边栏设计 (Sidebar - The Thought Tree)

侧边栏是用户的“上帝视角”地图。

### 2.0 导航层级 (Navigation Hierarchy)
侧边栏支持两种视图模式，通过顶部的导航栏切换：
*   **一级视图：会话列表 (Session List)**
    *   显示所有历史会话的列表（按时间排序）。
    *   点击某会话 -> 进入该会话的二级视图（Tree View）。
*   **二级视图：思维树 (Tree View)**
    *   **Header**: 显示 `[< Back]` 按钮和当前会话标题。
    *   **Body**: 显示当前会话的节点树结构。

### 2.1 视觉元素 (Visual Elements)

侧边栏采用类似 **Git Commit Graph** 或 **文件资源管理器** 的紧凑布局。

*   **User 节点 (提问)**：这是导航的核心锚点。
    *   **外观**：显示为带圆角的矩形胶囊或纯文本行。
    *   **内容**：显示提问的**摘要 (Summary)**（前 15-20 个字符，如 `"Refactor auth..."`）。
    *   **图标**：左侧带有小的 User 头像或气泡图标。
*   **AI 节点 (回答)**：
    *   **外观**：**视觉降权**。通常显示为连线上的一个小圆点 (Dot) 或直接隐藏在连线中，除非用户特意展开。
    *   **交互**：点击圆点可预览 AI 回答的开头。
*   **连线 (Connections)**：
    *   **主干 (Trunk)**：当前 Active 路径使用实线连接，高亮色（如蓝色）。
    *   **分支 (Branch)**：非 Active 路径使用虚线或灰色实线连接。
    *   **折叠 (Collapse)**：对于中间没有分叉的长线性对话段落，系统自动将其折叠为 `[...]` 节点，点击可展开。

### 2.2 交互状态
*   **Hover (悬停)**：鼠标悬停在任意节点上，显示完整摘要 Tooltip。同时高亮该节点到 Root 的路径，预测“如果切换过去，Context 是什么样”。
*   **Click (点击)**：
    *   点击任意节点 -> 主视窗立即刷新，加载该节点及其祖先节点的对话历史。
    *   **Edit Trigger (编辑触发)**：双击节点或点击节点旁的“笔”图标，直接在主视窗对该提问进入编辑模式。

## 3. 主对话区设计 (Main Chat Area - The Stream)

主视窗保持用户熟悉的 Chat UX，但在细节上增强了“分支感知”。

### 3.1 消息气泡与分叉
*   **显性化编辑入口**：
    *   每一条 User Message 气泡都有一个显著的 **[Edit / Fork]** 按钮。
    *   当用户点击历史消息的编辑按钮时，UI 提示：“这将创建一个新的分支”。
*   **分叉反馈**：
    *   用户提交修改后的提问 -> **侧边栏动画**：从被修改节点的父节点处，生长出一条新的连线和节点。
    *   主视窗自动切换到这个新分支，之前的回答被隐藏（但在侧边栏可找回）。

## 4. 关键交互流程 (Key Interaction Flows)

### 4.1 场景：代码调试 (Debugging)
1.  **初始路径**：User 提问 Q1 -> AI 回答 A1 (代码报错)。
2.  **尝试修复 A**：User 接着 A1 提问 Q2a ("尝试修改配置") -> AI 回答 A2a (失败)。
    *   *Sidebar*: Root -> Q1 -> A1 -> Q2a -> A2a
3.  **回溯与分支**：User 意识到方向错了。点击 Sidebar 上的 **A1** 节点。
    *   *Main View*: 此时显示 Root -> Q1 -> A1。A2a 及其提问消失（但在 Sidebar 上保留为灰色分支）。
4.  **尝试修复 B**：User 输入新的提问 Q2b ("尝试重写函数")。
    *   *Sidebar*: 在 A1 下方分叉，出现新的分支 Q2b -> A2b。
    *   *UI 反馈*: 用户现在可以点击 Sidebar 上的 Q2a 和 Q2b 快速对比两种修复方案的结果。

### 4.2 场景：上下文高亮 (Context Visualization)
*   假设 Sidebar 有一个深层的分支结构。
*   当前 Active 路径是 `Root -> A -> B -> C`。
*   Sidebar 上还有一个分支 `Root -> A -> D -> E`。
*   当用户把鼠标移动到节点 **E** 上：
    *   系统**高亮**路径 `Root -> A -> D -> E`。
    *   系统**置灰**节点 `B` 和 `C`。
    *   **目的**：直观告诉用户，“如果你切换到 E，AI 将会忘记 B 和 C 发生过的事情”。

## 5. 移动端适配策略 (Mobile Adaptation)
*   由于屏幕宽度限制，Sidebar 默认隐藏。
*   顶部导航栏增加一个 **[Tree Map]** 按钮。
*   点击按钮，以 Bottom Sheet 或 全屏覆盖层 形式展示树状结构。

